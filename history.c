#include "history.h"

#define NUM_SEGMENTS_CH1  10   //количество кусочков легче глазками посчитать ей богу
void chapter1(WINDOW *win) {
    if (!win) return;
    int max_y, max_x;  
    const char *segments[] = {
        "Чудесный вечер в хвойных чащобах. Вокруг тихо, лишь перманентный гул ветра иногда становится заметнее обычного, ни один лучик света не смущает взор, вы по привычке сидите на ветке пустого, изъеденного короедами-великанами, кедра и роетесь в дупле, где обосновались так горячо любимые всеми на чёрном рынке сонные осы-хронометры. Без солнца они практически слепы, лишь изредка ворочаются в своих восковых колыбельках, отливая в темноте призрачным, лунным перламутром. Вы уже предвкушаете, как аккуратно извлечёте эти драгоценные коконы и перетопите их в основу для «нектара забытых часов» — так местные алхимики-подпольщики романтично называют эликсир, дарующий мгновения, вырванные у времени.",
        "Рутина — страшная сила. Четыре дня подряд вы проделывали этот путь, как по конвейеру: сухие сосновые иглы под ногами шуршали одним и тем же шорохом, тот же корявый сук цеплял за рукав, те же тени пугали в первый и лишь раздражали к четвертому. Пальцы, действуя на автомате, уже почти нащупали гладкий воск. Сознание, убаюканное монотонностью и гулом ветра в пустотелом кроваво-багряном кедре, на миг отпустило бдительность.",
        "И в этот миг мир перевернулся.",
        "Не было ни шума, ни крика, ни предупреждающего шелеста веток. Только внезапный, сокрушительный удар всей тяжестью чужого тела сверху. Что-то твёрдое — сгиб локтя или колено — с хрустом впилось вам в шею и ключицу. Воздух вырвало из лёгких одним болезненным «хух». Вы не успели даже вскрикнуть. Ствол, дупло, звёзды — всё смешалось в тёмно-багровый вихрь. Вы кувыркались в воздухе, сплетённые с невесомым телом в чужом плаще, который хлестал по лицу мокрой от росы тканью. Последним, что вы увидели перед тем, как тьма нахлынула с краёв зрения, была чёрная гладь воды где-то внизу, стремительно несущаяся навстречу.",
        "Сознание уходило обрывками. Где-то очень далеко, будто из другого мира, послышались резкие, отрывистые, но неразборчивые выкрики.",
        "Голоса, спорящие и командирские, растворились в нарастающем гуле в ушах. А потом пришёл холод. Пронзительный, обжигающий ледяной иглами. Он вполз под кожу, сжал виски и грудь, и наконец выдернул вас из небытия резким спазмом всего тела.",
        "Вы очнулись.",
        "Мокрые, скользкие камни давят в спину. Вода окатывает ноги леденящим потоком каждым всплеском. Вы лежите на узкой полосе галечника, втиснутой меж темной стеной леса. Сосны нависают над вами, словно траурная свита. От кроваво-багряного кедра, от дупла, от ос — не осталось и следа. Холодно. Течением унесло почти всю одежду и вашу сумку с добычей.",
        "Обрывки воспоминаний складываются в простую картину: дозорные раскрыли ваш промысел, но перестарались. Ваше падение в реку — результат их глупой горячности, а теперь это шанс убраться из леса с добычей и целой шкурой.",
        "-Нужно вернуться к тайнику раньше чем его обнаружат эти мхомордые придурки!"
    };
    getmaxyx(win, max_y, max_x);
    
    for (int i = 0; i < NUM_SEGMENTS_CH1; i++) {
        werase(win);
        mvwprintw(win, 1, 1, "%s", segments[i]);
        
        // Подсказка (кроме последнего сегмента)
        if (i < NUM_SEGMENTS_CH1 - 1) {
            wattron(win, A_REVERSE);
            mvwprintw(win, max_y - 2, max_x/2 - 10, " Нажмите ПРОБЕЛ ");
            wattroff(win, A_REVERSE);
        } else {
            wattron(win, A_REVERSE);
            mvwprintw(win, max_y - 2, max_x/2 - 15, " Нажмите любую клавишу ");
            wattroff(win, A_REVERSE);
        }
        wrefresh(win);
        
        // Ждём ввода
        int ch = getch();
        if (ch == 27) { // esc - пропустить главу
            break;
        }
        
        if (i < NUM_SEGMENTS_CH1 - 1) {     // Для всех кроме последнего - ждём пробел  
            while (ch != ' ') {
                if (ch == 27) { // ESC
                    werase(win);
                    return;
                }
                ch = getch();
            }
        }
    }
    
    werase(win);
}


void chapter2(WINDOW *win){
    if (!win) return;
    int max_y, max_x, num_segments = 12;
    getmaxyx(win, max_y, max_x);
    
    const char *segments;
    for (int i = 0; i < num_segments; i++) {
        werase(win);
        mvwprintw(win, 1, 1, "%s", segments[i]);
        if (i < num_segments - 1) {
            wattron(win, A_REVERSE);
            mvwprintw(win, max_y - 2, max_x/2 - 10, " Нажмите ПРОБЕЛ ");
            wattroff(win, A_REVERSE);
        } else {
            wattron(win, A_REVERSE);
            mvwprintw(win, max_y - 2, max_x/2 - 15, "Нажмите любую клавишу ");
            wattroff(win, A_REVERSE);
        }
        wrefresh(win);
        
        // Ждём ввода
        int ch = getch();
        if (ch == 27) { 
            break;
        }
        
        if (i < num_segments - 1) {     
            while (ch != ' ') {
                if (ch == 27) { // ESC
                    werase(win);
                    return;
                }
                ch = getch();
            }
        }
    }
    werase(win);
}